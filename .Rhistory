summary.aov(results1)
results1 <- manova(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group) + as.factor(BVDV), data = data)
summary(results1)
summary.aov(results1)
results <- lda(BVDV ~ IFNG.D + SLAMF1.D + CXCR5.D + CD69.D + MKI67.D + KLRG1.D, data = data)
results
results2 <- lda(Pregnant ~ IFNG.D + SLAMF1.D + CXCR5.D + CD69.D + MKI67.D + KLRG1.D, data = data)
results2
results1 <- manova(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group) + as.factor(BVDV), data = data)
summary(results1)
summary.aov(results1)
data <- read.csv(file.choose())
results2 <- lda(Pregnant ~ IFNG.D + SLAMF1.D + CXCR5.D + CD69.D + MKI67.D + KLRG1.D, data = data)
results2
results3 <- lda(Group ~ IFNG.D + SLAMF1.D + CXCR5.D + CD69.D + MKI67.D + KLRG1.D, data = data)
results3
plot(results3)
table(data$Group,predict(results3)$class)
results3 <- lda(Group ~ IFNG.D + SLAMF1.D + CXCR5.D + CD69.D + MKI67.D, data = data)
results3
table(data$Group,predict(results3)$class)
results4 <- princomp(~KLRG1.D + SLAMF1.D + IFNG.D + CXCR5.D + CD69.D + MKI67.D, data = data)
summary(results4)
results4$loadings
splom(~data.frame(KLRG1.D,IFNG.D,CXCR5.D,CD69.D,SLAMF1.D), data = data, groups = Group)
splom(~data.frame(KLRG1.D,IFNG.D,CXCR5.D,CD69.D,SLAMF1.D,MKI67.D), data = data, groups = Group)
autoplot(results4)
library(ggplot2)
autoplot(results4)
install.packages(c("ape", "askpass", "bit", "bitops", "bookdown", "caret", "commonmark", "cpp11", "curl", "data.table", "evaluate", "fontawesome", "fs", "ggfun", "gower", "gtable", "insight", "knitr", "later", "lubridate", "openssl", "parallelly", "progressr", "promises", "ps", "quantreg", "Rcpp", "rmarkdown", "RSQLite", "rstudioapi", "shiny", "sys", "textshaping", "tinytex", "withr", "xfun", "yulab.utils"))
install.packages(c("ape", "askpass", "bit", "bitops", "bookdown", "caret", "commonmark", "cpp11", "curl", "data.table", "evaluate", "fontawesome", "fs", "ggfun", "gower", "gtable", "insight", "knitr", "later", "lubridate", "openssl", "parallelly", "progressr", "promises", "ps", "quantreg", "Rcpp", "rmarkdown", "RSQLite", "rstudioapi", "shiny", "sys", "textshaping", "tinytex", "withr", "xfun", "yulab.utils"))
install.packages(c("ape", "askpass", "bit", "bitops", "bookdown", "caret", "commonmark", "cpp11", "curl", "data.table", "evaluate", "fontawesome", "fs", "ggfun", "gower", "gtable", "insight", "knitr", "later", "lubridate", "openssl", "parallelly", "progressr", "promises", "ps", "quantreg", "Rcpp", "rmarkdown", "RSQLite", "rstudioapi", "shiny", "sys", "textshaping", "tinytex", "withr", "xfun", "yulab.utils"))
results4 <- prcomp(~KLRG1.D + SLAMF1.D + IFNG.D + CXCR5.D + CD69.D + MKI67.D, data = data)
summary(results4)
library(ggplot2)
autoplot(results4)
splom(~data.frame(KLRG1.D,IFNG.D,CXCR5.D,CD69.D,SLAMF1.D,MKI67.D), data = data, scale = TRUE)
results4 <- prcomp(~KLRG1.D + SLAMF1.D + IFNG.D + CXCR5.D + CD69.D + MKI67.D, data = data)
summary(results4)
install.packages("ggfortify")
library(ggplot2)
library(ggfortify)
autoplot(results4)
autoplot(results4, color = data$Group)
autoplot(results4, data = data , color = "Group")
autoplot(results4, data = data , colour = "Group")
results4 <- prcomp(~SLAMF1.D + IFNG.D + CXCR5.D + CD69.D + MKI67.D, data = data)
summary(results4)
autoplot(results4, data = data , colour = "Group")
results4 <- prcomp(~SLAMF1.D + IFNG.D + CXCR5.D + CD69.D + MKI67.D, data = data)
summary(results4)
results4$loadings
results4 <- princomp(~SLAMF1.D + IFNG.D + CXCR5.D + CD69.D + MKI67.D, data = data)
summary(results4)
results4$loadings
autoplot(results4, data = data , colour = "Group")
splom(~data.frame(KLRG1.D,IFNG.D,CXCR5.D,CD69.D,SLAMF1.D,MKI67.D), data = data, groups = Group)
results1 <- manova(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group) + as.factor(BVDV), data = data)
summary(results1)
summary.aov(results1)
results1 <- manova(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data)
summary(results1)
summary.aov(results1)
confint(results1)
library(boot)
results1 <- manova(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data)
summary(results1)
summary.aov(results1)
results5 <- manova(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data)
summary(results1)
summary.aov(results1)
vif(results5)
library(car)
vif(results5)
cor.test(x = KLRG1.D, y = SMALF1.d, data = data, method = "pearson")$estimate
cor.test(x = data$KLRG1.D, y = data$SMALF1.d, method = "pearson")$estimate
cor.test(x = data$KLRG1.D, y = data$SMALF1.D, method = "pearson")$estimate
cor.test(x = data$KLRG1.D, y = data$SLAMF1.D, method = "pearson")$estimate
cor.test(x = data$KLRG1.D, y = data$IFNG.D, method = "pearson")$estimate
cor.test(x = data$KLRG1.D, y = data$CXCR5.D, method = "pearson")$estimate
cor.test(x = data$KLRG1.D, y = data$IFNG.D, method = "pearson")$estimate
cor.test(x = data$KLRG1.D, y = data$SLAMF1.D, method = "pearson")$estimate
cor.test(x = data$KLRG1.D, y = data$CD69.D, method = "pearson")$estimate
cor.test(x = data$KLRG1.D, y = data$MKI67.D, method = "pearson")$estimate
cor.test(x = data$SLAMF1.D, y = data$IFNG.D, method = "pearson")$estimate
cor.test(x = data$SLAMF1.D, y = data$CXCR5.D, method = "pearson")$estimate
cor.test(x = data$SLAMF1.D, y = data$CD69.D, method = "pearson")$estimate
cor.test(x = data$SLAMF1.D, y = data$MKI67.D, method = "pearson")$estimate
cor.test(x = data$IFNG.D, y = data$CXCR5.D, method = "pearson")$estimate
cor.test(x = data$IFNG.D, y = data$CD69.D, method = "pearson")$estimate
cor.test(x = data$IFNG.D, y = data$MKI67.D, method = "pearson")$estimate
cor.test(x = data$CXCR5.D, y = data$MKI67.D, method = "pearson")$estimate
cor.test(x = data$CXCR5.D, y = data$CD69.D, method = "pearson")$estimate
cor.test(x = data$CD69.D, y = data$MKI67.D, method = "pearson")$estimate
View(results4)
install.packages("MANOVA.RM")
library(MANOVA.RM)
test <- MANOVA.wide(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data, iter = 1000, resampling = "paramBS")
summary(test)
cr <- conf.reg(test)
cr
plot(cr, col = 6, lty = 6)
test <- MANOVA.wide(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data, iter = 1000, resampling = "paramBS")
summary(test)
cr <- conf.reg(test)
cr
install.packages("HSAUR3")
if (requireNamespace("HSAUR3", quitely = TRUE)) {
library(HSAUR3)
data = data
test <- MANOVA.wide(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data, iter = 1000, resampling = "paramBS")
summary(test)
cr <- conf.reg(test)
cr
plot(cr)
}
if (requireNamespace("HSAUR3", quitely = TRUE)) {
library(HSAUR3)
data = data
test <- MANOVA.wide(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data, iter = 1000, resampling = "paramBS")
summary(test)
cr <- conf.reg(test)
cr
plot(cr)
}
if (requireNamespace("HSAUR3")) {
library(HSAUR3)
data = data
test <- MANOVA.wide(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data, iter = 1000, resampling = "paramBS")
summary(test)
cr <- conf.reg(test)
cr
plot(cr)
}
if (requireNamespace("HSAUR3")) {
library(HSAUR3)
data = data
test <- MANOVA.wide(cbind(KLRG1.D, IFNG.D) ~ as.factor(Group), data = data, iter = 1000, resampling = "paramBS")
summary(test)
cr <- conf.reg(test)
cr
plot(cr)
}
test <- MANOVA.wide(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data, iter = 1000, resampling = "paramBS")
summary(test)
cr <- conf.reg(test)
test <- MANOVA.wide(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data, iter = 1000, resampling = "paramBS")
summary(test)
results5 <- manova(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data, )
summary(resultS5, test = "Wilks")
results5 <- manova(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data, )
summary(results5, test = "Wilks")
install.packages("heplots")
cov_matrix <- summary(results5)$SS["Residuals"] / results5$df.residual
results3 <- lda(Group ~ IFNG.D + CD69.D , data = data) #+ SLAMF1.D + CXCR5.D + MKI67.D
library(MASS)
library(lattice)
results3 <- lda(Group ~ IFNG.D + CD69.D , data = data) #+ SLAMF1.D + CXCR5.D + MKI67.D
results3
plot(results3)
results5 <- manova(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data, )
summary(results5)
results5 <- manova(cbind(KLRG1.D, IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data, )
summary(results5)
summary.aov(results5)
results3 <- lda(Group ~ IFNG.D + MKI67.D + CXCR5.D, data = data)
results3
plot(results3)
table(data$Group,predict(results3)$class)
results3 <- lda(Group ~ IFNG.D + MKI67.D + CXCR5.D + CD69.D, data = data)
results3
plot(results3)
table(data$Group,predict(results3)$class)
table(data$Group,predict(results3)$class)
results4 <- princomp(~IFNG.D + CXCR5.D + CD69.D + MKI67.D, data = data)
summary(results4)
results4$loadings
autoplot(results4, data = data , colour = "Group")
results5 <- manova(cbind(IFNG.D, SLAMF1.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data, )
summary(results5)
summary.aov(results5)
results3 <- lda(Group ~ IFNG.D + MKI67.D + CXCR5.D + CD69.D + KLRG1, data = data)
results3 <- lda(Group ~ IFNG.D + MKI67.D + CXCR5.D + CD69.D + KLRG1.D, data = data)
results3
plot(results3)
results <- lda(BVDV ~ IFNG.D + SLAMF1.D + CXCR5.D + CD69.D + MKI67.D + KLRG1.D, data = data)
results
results2 <- lda(Pregnant ~ IFNG.D + SLAMF1.D + CXCR5.D + CD69.D + MKI67.D + KLRG1.D, data = data)
results2
results3 <- lda(Group ~ IFNG.D + MKI67.D + CXCR5.D + CD69.D + KLRG1.D, data = data)
results3
plot(results3)
table(data$Group,predict(results3)$class)
results4 <- princomp(~IFNG.D + CXCR5.D + CD69.D + MKI67.D + KLRG1, data = data)
results4 <- princomp(~IFNG.D + CXCR5.D + CD69.D + MKI67.D + KLRG1.D, data = data)
summary(results4)
results4$loadings
splom(~data.frame(KLRG1.D,IFNG.D,CXCR5.D,CD69.D,SLAMF1.D,MKI67.D), data = data, groups = Group)
splom(~data.frame(KLRG1.D,IFNG.D,CXCR5.D,CD69.D,MKI67.D), data = data, groups = Group)
autoplot(results4, data = data , colour = "Group")
library(ggplot2)
library(ggfortify)
autoplot(results4, data = data , colour = "Group")
plot(results3)
results3 <- lda(Group ~ IFNG.D + MKI67.D + CXCR5.D + CD69.D, data = data)
results3
plot(results3)
splom(~data.frame(KLRG1.D,IFNG.D,CXCR5.D,CD69.D,MKI67.D), data = data, groups = Group)
autoplot(results4, data = data , colour = "Group")
autoplot(results4, data = data , colour = "Group")
results4 <- princomp(~IFNG.D + CXCR5.D + CD69.D + MKI67.D, data = data)
summary(results4)
autoplot(results4, data = data , colour = "Group")
results5 <- manova(cbind(KLRG1.D, IFNG.D, CXCR5.D, CD69.D, MKI67.D) ~ as.factor(Group), data = data, )
summary(results5)
summary.aov(results5)
cov_matrix <- summary(results5)$SS["Residuals"] / results5$df.residual
cov_matrix <- summary(results5)$SS["Residuals"] / results5$df.residual
install.packages("quartro")
install.packages("tidyverse")
install.packages("palmerpenguins")
install.packages("quarto")
install.packages("RSQLite")
library(RSQLite)
conn <- dbConnect(RSQLite::SQLite(), "example.db")
library(RSQLite)
conn <- dbConnect(RSQLite::SQLite(), "example.db")
conn <- dbConnect(RSQLite::SQLite(), "example.db")
View(conn)
if (Table1 == -1){
cat ("An error has occurred.\n")
msg <- odbcGetErrMsg(conn)
print (msg)
} else {
cat ("Table was created successfully.\n")
}
if (Table1 == -1){
cat ("An error has occurred.\n")
msg <- odbcGetErrMsg(conn)
print (msg)
} else {
cat ("Table was created successfully.\n")
}
Table1 <- dbExecute(conn,
"CREATE TABLE Customers (
customer_id INTEGER NOT NULL ,
country_name VARCHAR(20) NOT NULL,
country_code VARCHAR(20) NOT NULL
)",
errors=FALSE
)
if (Table1 == -1){
cat ("An error has occurred.\n")
msg <- odbcGetErrMsg(conn)
print (msg)
} else {
cat ("Table was created successfully.\n")
}
insert_data_query <- "
INSERT INTO Customers (customer_id, country_name, country_code) VALUES
(101, 'United Kingdom', 'UK'),
(101, 'United Kingdom', 'UK'),
(102, 'Canada', 'CA'),
(102, 'Canada', 'CA'),
(101, 'United Kingdom', 'UK'),
(103, 'Mexico', 'MX'),
(104, 'Malaysia', 'MY'),
(104, 'Malaysia', 'MY'),
(101, 'United Kingdom', 'UK'),
(105, 'Norway', 'NO'),
(105, 'Norway', 'NO');"
dbExecute(conn, insert_data_query)
head Table1
head(Table1)
tables <- dbListTables(conn)
print(tables)
dbGetQuery(conn, "SELECT * FROM Customers")
dbExecute(conn, "UPDATE Customers SET country_name = 'Britain' WHERE country_code = 'UK';")
dbGetQuery(conn, "SELECT * FROM Customers")
dbExecute(conn, "DELETE FROM Customers WHERE country_name = 'Britain';")
dbGetQuery(conn, "SELECT * FROM Customers")
dbDisconnect(conn)
db_path <- "clinical_trial.db"
schema_path <- file.path("sql", "01_create_tables.sql")
data_dir <- file.path("data")
files <- list(
sites    = file.path(data_dir, "sites.csv"),
patients = file.path(data_dir, "patients.csv"),
visits   = file.path(data_dir, "visits.csv"),
outcomes = file.path(data_dir, "outcomes.csv"),
notes    = file.path(data_dir, "notes.csv")
)
conn <- dbConnect(RSQLite::SQLite(), db_path)
library(DBI)
library(RSQLite)
library(readr)
library(dplyr)
conn <- dbConnect(RSQLite::SQLite(), db_path)
# Enforce foreign keys in SQLite (must be ON per-connection)
dbExecute(con, "PRAGMA foreign_keys = ON;")
conn <- dbConnect(RSQLite::SQLite(), db_path)
# Enforce foreign keys in SQLite (must be ON per-connection)
dbExecute(conn, "PRAGMA foreign_keys = ON;")
db_path <- "clinical_trial.db"
schema_path <- list(
file.path("sql", "01_sites.sql"),
file.path("sql", "02_patients.sql"),
file.path("sql", "03_visits.sql"),
file.path("sql", "04_outcomes.sql"),
file.path("sql", "05_notes.sql")
)
data_dir <- file.path("data")
files <- list(
sites    = file.path(data_dir, "sites.csv"),
patients = file.path(data_dir, "patients.csv"),
visits   = file.path(data_dir, "visits.csv"),
outcomes = file.path(data_dir, "outcomes.csv"),
notes    = file.path(data_dir, "notes.csv")
)
conn <- dbConnect(RSQLite::SQLite(), db_path)
# Enforce foreign keys in SQLite (must be ON per-connection)
dbExecute(conn, "PRAGMA foreign_keys = ON;")
# NOTE: This will drop existing tables if you rerun.
# If you want that behavior, keep this block. Otherwise comment out.
tables <- c("notes", "outcomes", "visits", "patients", "sites")
for (t in tables) dbExecute(conn, paste0("DROP TABLE IF EXISTS ", t, ";"))
schema_sql <- readLines(schema_path, warn = FALSE)
# NOTE: This will drop existing tables if you rerun.
# If you want that behavior, keep this block. Otherwise comment out.
tables <- c("notes", "outcomes", "visits", "patients", "sites")
for (t in tables) dbExecute(conn, paste0("DROP TABLE IF EXISTS ", t, ";"))
schema_sql <- readLines(schema_path, warn = FALSE)
db_path <- "clinical_trial.db"
schema_paths <- c(
file.path("sql", "01_sites.sql"),
file.path("sql", "02_patients.sql"),
file.path("sql", "03_visits.sql"),
file.path("sql", "04_outcomes.sql"),
file.path("sql", "05_notes.sql")
)
data_dir <- file.path("data")
files <- list(
sites    = file.path(data_dir, "sites.csv"),
patients = file.path(data_dir, "patients.csv"),
visits   = file.path(data_dir, "visits.csv"),
outcomes = file.path(data_dir, "outcomes.csv"),
notes    = file.path(data_dir, "notes.csv")
)
db_path <- "clinical_trial.db"
schema_paths <- c(
file.path("sql", "01_sites.sql"),
file.path("sql", "02_patients.sql"),
file.path("sql", "03_visits.sql"),
file.path("sql", "04_outcomes.sql"),
file.path("sql", "05_notes.sql")
)
data_dir <- file.path("data")
files <- list(
sites    = file.path(data_dir, "sites.csv"),
patients = file.path(data_dir, "patients.csv"),
visits   = file.path(data_dir, "visits.csv"),
outcomes = file.path(data_dir, "outcomes.csv"),
notes    = file.path(data_dir, "notes.csv")
)
conn <- dbConnect(RSQLite::SQLite(), db_path)
# Enforce foreign keys in SQLite (must be ON per-connection)
dbExecute(conn, "PRAGMA foreign_keys = ON;")
# NOTE: This will drop existing tables if you rerun.
# If you want that behavior, keep this block. Otherwise comment out.
tables <- c("notes", "outcomes", "visits", "patients", "sites")
for (t in tables) dbExecute(conn, paste0("DROP TABLE IF EXISTS ", t, ";"))
for (p in schema_paths) {
sql <- paste(readLines(p, warn = FALSE), collapse = "\n")
dbExecute(conn, sql)
}
setwd("~/GitHub/Clinical-Trial-Analytics---ML-Pipeline/r")
# NOTE: This will drop existing tables if you rerun.
# If you want that behavior, keep this block. Otherwise comment out.
tables <- c("notes", "outcomes", "visits", "patients", "sites")
for (t in tables) dbExecute(conn, paste0("DROP TABLE IF EXISTS ", t, ";"))
for (p in schema_paths) {
sql <- paste(readLines(p, warn = FALSE), collapse = "\n")
dbExecute(conn, sql)
}
# NOTE: This will drop existing tables if you rerun.
# If you want that behavior, keep this block. Otherwise comment out.
tables <- c("notes", "outcomes", "visits", "patients", "sites")
for (t in tables) dbExecute(conn, paste0("DROP TABLE IF EXISTS ", t, ";"))
stopifnot(all(file.exists(schema_paths)))
setwd("~/GitHub/Clinical-Trial-Analytics---ML-Pipeline")
# NOTE: This will drop existing tables if you rerun.
# If you want that behavior, keep this block. Otherwise comment out.
tables <- c("notes", "outcomes", "visits", "patients", "sites")
for (t in tables) dbExecute(conn, paste0("DROP TABLE IF EXISTS ", t, ";"))
stopifnot(all(file.exists(schema_paths)))
# NOTE: This will drop existing tables if you rerun.
# If you want that behavior, keep this block. Otherwise comment out.
tables <- c("notes", "outcomes", "visits", "patients", "sites")
for (t in tables) dbExecute(conn, paste0("DROP TABLE IF EXISTS ", t, ";"))
stopifnot(all(file.exists(schema_paths)))
# NOTE: This will drop existing tables if you rerun.
# If you want that behavior, keep this block. Otherwise comment out.
tables <- c("notes", "outcomes", "visits", "patients", "sites")
for (t in tables) dbExecute(conn, paste0("DROP TABLE IF EXISTS ", t, ";"))
#stopifnot(all(file.exists(schema_paths)))
for (p in schema_paths) {
message("Applying schema: ", p)
sql <- paste(readLines(p, warn = FALSE), collapse = "\n")
dbExecute(conn, sql)
}
getwd()
list.files()
list.files("sql")
# NOTE: This will drop existing tables if you rerun.
# If you want that behavior, keep this block. Otherwise comment out.
tables <- c("notes", "outcomes", "visits", "patients", "sites")
for (t in tables) dbExecute(conn, paste0("DROP TABLE IF EXISTS ", t, ";"))
#stopifnot(all(file.exists(schema_paths)))
for (p in schema_paths) {
message("Applying schema: ", p)
sql <- paste(readLines(p, warn = FALSE), collapse = "\n")
dbExecute(conn, sql)
}
readLines(file.path("sql", "01_sites.sql"), warn = FALSE)
# NOTE: This will drop existing tables if you rerun.
# If you want that behavior, keep this block. Otherwise comment out.
tables <- c("notes", "outcomes", "visits", "patients", "sites")
for (t in tables) dbExecute(conn, paste0("DROP TABLE IF EXISTS ", t, ";"))
#stopifnot(all(file.exists(schema_paths)))
for (p in schema_paths) {
message("Applying schema: ", p)
sql <- paste(readLines(p, warn = FALSE), collapse = "\n")
dbExecute(conn, sql)
}
# NOTE: This will drop existing tables if you rerun.
# If you want that behavior, keep this block. Otherwise comment out.
tables <- c("notes", "outcomes", "visits", "patients", "sites")
for (t in tables) dbExecute(conn, paste0("DROP TABLE IF EXISTS ", t, ";"))
#stopifnot(all(file.exists(schema_paths)))
for (p in schema_paths) {
message("Applying schema: ", p)
sql <- paste(readLines(p, warn = FALSE), collapse = "\n")
dbExecute(conn, sql)
}
db_path <- "clinical_trial.db"
schema_paths <- c(
file.path("sql", "01_sites.sql"),
file.path("sql", "02_patients.sql"),
file.path("sql", "03_visits.sql"),
file.path("sql", "04_outcomes.sql"),
file.path("sql", "05_notes.sql")
)
data_dir <- file.path("data")
files <- list(
sites    = file.path(data_dir, "sites.csv"),
patients = file.path(data_dir, "patients.csv"),
visits   = file.path(data_dir, "visits.csv"),
outcomes = file.path(data_dir, "outcomes.csv"),
notes    = file.path(data_dir, "notes.csv")
)
conn <- dbConnect(RSQLite::SQLite(), db_path)
# Enforce foreign keys in SQLite (must be ON per-connection)
dbExecute(conn, "PRAGMA foreign_keys = ON;")
# NOTE: This will drop existing tables if you rerun.
# If you want that behavior, keep this block. Otherwise comment out.
tables <- c("notes", "outcomes", "visits", "patients", "sites")
for (t in tables) dbExecute(conn, paste0("DROP TABLE IF EXISTS ", t, ";"))
#stopifnot(all(file.exists(schema_paths)))
for (p in schema_paths) {
message("Applying schema: ", p)
sql <- paste(readLines(p, warn = FALSE), collapse = "\n")
dbExecute(conn, sql)
}
readLines(file.path("sql", "01_sites.sql"), warn = FALSE)
for (p in schema_paths) {
message("Applying schema: ", p)
sql <- paste(readLines(p, warn = FALSE), collapse = "\n")
dbExecute(conn, sql)
}
# NOTE: This will drop existing tables if you rerun.
# If you want that behavior, keep this block. Otherwise comment out.
tables <- c("notes", "outcomes", "visits", "patients", "sites")
for (t in tables) dbExecute(conn, paste0("DROP TABLE IF EXISTS ", t, ";"))
#stopifnot(all(file.exists(schema_paths)))
for (p in schema_paths) {
message("Applying schema: ", p)
lines <- readLines(p, warn = FALSE)
# remove full-line SQL comments that start with --
lines <- lines[!grepl("^\\s*--", lines)]
sql <- paste(lines, collapse = "\n")
dbExecute(conn, sql)
}
for (p in schema_paths) {
message("Applying schema: ", p)
lines <- readLines(p, warn = FALSE)
# remove full-line SQL comments that start with --
lines <- lines[!grepl("^\\s*--", lines)]
sql <- paste(lines, collapse = "\n")
dbExecute(conn, sql)
}
for (p in schema_paths) {
message("Applying schema: ", p)
lines <- readLines(p, warn = FALSE), collapse = "\n")
stopifnot(all(file.exists(schema_paths)))
for (p in schema_paths) {
message("Applying schema: ", p)
sql <- paste(readLines(p, warn = FALSE), collapse = "\n")
dbExecute(conn, sql)
}
dbListTables(conn)
dbListTables(conn)
dbGetQuery(conn, "PRAGMA table_info(patients);")
